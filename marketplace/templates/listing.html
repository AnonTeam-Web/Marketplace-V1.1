{% extends "base.html" %}
{% block content %}

<div class="container mt-4">
  <h2 class="mb-3 text-center">Marketplace : missions, offres et données</h2>

  {% if missions %}
    <div class="row">
      {% for mission in missions %}
        <div class="col-md-4 mb-4">
          <div class="card shadow-sm border-0 h-100">
            <div class="card-body">
              <h5 class="card-title text-primary">
                {% if mission.type == 'mission' %}
                  <i class="bi bi-briefcase-fill me-1"></i> Mission
                {% elif mission.type == 'offre' %}
                  <i class="bi bi-cash-stack me-1"></i> Offre
                {% elif mission.type == 'donnee' %}
                  <i class="bi bi-file-earmark-text me-1"></i> Donnée
                {% endif %}
                {{ mission.titre }}
              </h5>

              {% if mission.description %}
                <p class="card-text text-muted small">{{ mission.description[:150] }}{% if mission.description|length > 150 %}...{% endif %}</p>
              {% endif %}

              <ul class="list-unstyled mb-3">
                {% if mission.data_label %}
                  <li><i class="bi bi-tag me-1"></i> Catégorie : {{ mission.data_label }}</li>
                {% endif %}
                {% if mission.date_butoir %}
                  <li><i class="bi bi-calendar-event me-1"></i> Date butoir : {{ mission.date_butoir.strftime('%d/%m/%Y') }}</li>
                {% endif %}
                {% if mission.quantity %}
                  <li><i class="bi bi-box-seam me-1"></i> Quantité : {{ mission.quantity }}</li>
                {% endif %}

                {% if mission.type == 'donnee' %}
                  {% if mission.prix_achat %}
                    <li><i class="bi bi-currency-euro me-1"></i> Prix d’achat : {{ mission.prix_achat }} €</li>
                  {% endif %}
                {% else %}
                  {% if mission.prix %}
                    <li><i class="bi bi-coin me-1"></i> Prix : {{ mission.prix }} crédits</li>
                  {% endif %}
                {% endif %}
              </ul>

              {% if mission.offres %}
                {% set best = None %}
                {% for o in mission.offres %}
                  {% if not best or o.prix > best.prix %}
                    {% set best = o %}
                  {% endif %}
                {% endfor %}
                {% if best %}
                  <div class="alert alert-success py-2 small mb-3">
                    <i class="bi bi-trophy-fill me-1"></i> Meilleure offre : {{ best.prix }} crédits ({{ best.vendeur_id }})
                  </div>
                {% endif %}
              {% endif %}

              <a href="{{ url_for('mission_detail', id=mission.id) }}" class="btn btn-sm btn-outline-primary">
                Voir le détail
              </a>
            </div>
          </div>
        </div>
      {% endfor %}
    </div>

  {% else %}
    <div class="alert alert-info text-center mt-4">
      Aucune mission, offre ou donnée disponible pour le moment.
    </div>
  {% endif %}
</div>

{% endblock %}
